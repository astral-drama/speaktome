<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeakToMe Voice-to-Text</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-microphone"></i>
                    <span>SpeakToMe Voice-to-Text</span>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" id="settingsBtn">
                        <i class="fas fa-cog"></i>
                        Settings
                    </button>
                    <div class="connection-status" id="connectionStatus">
                        <div class="status-indicator connecting"></div>
                        <span>Connecting...</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Chat Interface -->
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message system">
                        <div class="message-content">
                            <p>Welcome to Whisper Voice-to-Text! Click the microphone button to start recording.</p>
                        </div>
                        <div class="message-time">
                            <span id="welcomeTime"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recording Controls (STT) -->
            <div class="recording-controls">
                <div class="section-header">
                    <h3><i class="fas fa-microphone"></i> Speech to Text</h3>
                </div>
                <div class="recording-status" id="recordingStatus">
                    <div class="status-text">Ready to record</div>
                    <div class="audio-level">
                        <div class="audio-level-bar" id="audioLevel"></div>
                    </div>
                </div>

                <div class="control-buttons">
                    <button class="btn btn-primary record-btn" id="recordBtn" disabled>
                        <i class="fas fa-microphone"></i>
                        <span>Start Recording</span>
                    </button>

                    <button class="btn btn-secondary" id="uploadBtn">
                        <i class="fas fa-upload"></i>
                        <span>Upload File</span>
                    </button>

                    <button class="btn btn-secondary" id="clearBtn">
                        <i class="fas fa-trash"></i>
                        <span>Clear Chat</span>
                    </button>
                </div>
            </div>

            <!-- TTS Controls -->
            <div class="tts-controls">
                <div class="section-header">
                    <h3><i class="fas fa-volume-up"></i> Text to Speech</h3>
                </div>

                <div class="tts-input-area">
                    <textarea
                        id="ttsTextInput"
                        class="tts-textarea"
                        placeholder="Enter text to convert to speech..."
                        rows="4"
                        maxlength="5000"
                    ></textarea>
                    <div class="char-counter">
                        <span id="charCount">0</span> / 5000 characters
                    </div>
                </div>

                <div class="tts-settings">
                    <div class="setting-inline">
                        <label for="voiceSelect"><i class="fas fa-user"></i> Voice</label>
                        <select id="voiceSelect" class="form-control">
                            <option value="default">Loading voices...</option>
                        </select>
                    </div>

                    <div class="setting-inline">
                        <label for="speedSlider"><i class="fas fa-tachometer-alt"></i> Speed</label>
                        <div class="slider-container">
                            <input
                                type="range"
                                id="speedSlider"
                                class="speed-slider"
                                min="0.5"
                                max="2.0"
                                step="0.1"
                                value="1.0"
                            >
                            <span id="speedValue">1.0x</span>
                        </div>
                    </div>
                </div>

                <div class="tts-buttons">
                    <button class="btn btn-primary" id="speakBtn" disabled>
                        <i class="fas fa-play"></i>
                        <span>Speak</span>
                    </button>

                    <button class="btn btn-secondary" id="stopSpeakBtn" style="display: none;">
                        <i class="fas fa-stop"></i>
                        <span>Stop</span>
                    </button>

                    <button class="btn btn-secondary" id="downloadAudioBtn" style="display: none;">
                        <i class="fas fa-download"></i>
                        <span>Download Audio</span>
                    </button>
                </div>

                <div class="tts-status" id="ttsStatus" style="display: none;">
                    <div class="status-indicator"></div>
                    <span class="status-message">Processing...</span>
                </div>
            </div>
        </main>

        <!-- Settings Modal -->
        <div class="modal" id="settingsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="close-btn" id="closeSettings">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="setting-group">
                        <label for="modelSelect">Whisper Model</label>
                        <select id="modelSelect" class="form-control">
                            <option value="tiny">Tiny (Fastest, Less Accurate)</option>
                            <option value="base" selected>Base (Balanced)</option>
                            <option value="small">Small (Better Accuracy)</option>
                            <option value="medium">Medium (High Accuracy)</option>
                            <option value="large">Large (Best Accuracy, Slowest)</option>
                        </select>
                        <small>Larger models provide better accuracy but take longer to process.</small>
                    </div>
                    
                    <div class="setting-group">
                        <label for="languageSelect">Language</label>
                        <select id="languageSelect" class="form-control">
                            <option value="">Auto-detect</option>
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                            <option value="zh">Chinese</option>
                            <option value="ja">Japanese</option>
                            <option value="ko">Korean</option>
                        </select>
                        <small>Leave as auto-detect for best results if unsure.</small>
                    </div>
                    
                    <div class="setting-group">
                        <label for="recordingMode">Recording Mode</label>
                        <select id="recordingMode" class="form-control">
                            <option value="streaming">Real-time Streaming</option>
                            <option value="batch" selected>Batch Processing</option>
                        </select>
                        <small>Batch processing is more reliable and provides cleaner transcriptions.</small>
                    </div>
                    
                    <div class="setting-group">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="autoSend" checked>
                            <label for="autoSend">Auto-send on recording stop</label>
                        </div>
                        <small>Automatically process audio when recording stops.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="resetSettings">Reset Defaults</button>
                    <button class="btn btn-primary" id="saveSettings">Save Settings</button>
                </div>
            </div>
        </div>

        <!-- File Upload Modal -->
        <div class="modal" id="uploadModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Upload Audio File</h2>
                    <button class="close-btn" id="closeUpload">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p class="upload-text">
                            Drop audio files here or <button class="upload-browse" id="browseBtn">browse</button>
                        </p>
                        <p class="upload-formats">
                            Supported formats: MP3, WAV, FLAC, M4A, WebM, OGG
                        </p>
                        <input type="file" id="fileInput" accept="audio/*" style="display: none;">
                    </div>
                    
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text">
                            <span id="progressText">Uploading...</span>
                            <span id="progressPercent">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p class="loading-text" id="loadingText">Processing audio...</p>
            </div>
        </div>
    </div>

    <!-- Error Toast -->
    <div class="toast error" id="errorToast" style="display: none;">
        <div class="toast-content">
            <i class="fas fa-exclamation-circle"></i>
            <span class="toast-message" id="errorMessage"></span>
        </div>
        <button class="toast-close" id="closeError">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Success Toast -->
    <div class="toast success" id="successToast" style="display: none;">
        <div class="toast-content">
            <i class="fas fa-check-circle"></i>
            <span class="toast-message" id="successMessage"></span>
        </div>
        <button class="toast-close" id="closeSuccess">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/audio-client.js"></script>
    <script src="js/tts-client.js"></script>
    <script src="js/chat-interface.js"></script>
    <script src="js/app.js"></script>
</body>
</html>